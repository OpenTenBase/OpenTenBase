------------------------------------------------------------
-- A part of opentenbase_ora.sql, test to functions related cases.
------------------------------------------------------------
\c regression_ora
\set ECHO all
SET client_min_messages = warning;
SET datestyle TO ISO;
SET client_encoding = utf8;
SET intervalstyle to sql_standard;
--test TO_CHAR
select TO_CHAR(22);
 TO_CHAR 
---------
 22
(1 row)

select TO_CHAR(99::smallint);
 TO_CHAR 
---------
 99
(1 row)

select TO_CHAR(-44444);
 TO_CHAR 
---------
 -44444
(1 row)

select TO_CHAR(1234567890123456::bigint);
     TO_CHAR      
------------------
 1234567890123456
(1 row)

select TO_CHAR(123.456::real);
 TO_CHAR 
---------
 123.456
(1 row)

select TO_CHAR(1234.5678::double precision);
  TO_CHAR  
-----------
 1234.5678
(1 row)

select TO_CHAR(12345678901234567890::numeric);
       TO_CHAR        
----------------------
 12345678901234567890
(1 row)

select TO_CHAR(1234567890.12345);
     TO_CHAR      
------------------
 1234567890.12345
(1 row)

select TO_CHAR('4.00'::numeric);
 TO_CHAR 
---------
 4
(1 row)

select TO_CHAR('4.0010'::numeric);
 TO_CHAR 
---------
 4.001
(1 row)

-- test special case of '$' in int_to_char fmt
select TO_CHAR(123,'$99,999.9') from dual;
  TO_CHAR   
------------
     $123.0
(1 row)

select LENGTH(TO_CHAR(123,'$99,999.9')) from dual;
 LENGTH 
--------
     10
(1 row)

select TO_CHAR(123,'$99,9,999.9') from dual;
   TO_CHAR    
--------------
       $123.0
(1 row)

select LENGTH(TO_CHAR(123,'$99,9,999.9')) from dual;
 LENGTH 
--------
     12
(1 row)

select TO_CHAR(123,'99,9,9$99.9') from dual;
   TO_CHAR    
--------------
       $123.0
(1 row)

select LENGTH(TO_CHAR(123,'99,9,9$99.9')) from dual;
 LENGTH 
--------
     12
(1 row)

select TO_CHAR(123,'99,9,999.9$') from dual;
   TO_CHAR    
--------------
       $123.0
(1 row)

select LENGTH(TO_CHAR(123,'99,9,999.9$')) from dual;
 LENGTH 
--------
     12
(1 row)

-- with sign
select TO_CHAR(+123,'$99,999.9') from dual;
  TO_CHAR   
------------
     $123.0
(1 row)

select LENGTH(TO_CHAR(+123,'$99,999.9')) from dual;
 LENGTH 
--------
     10
(1 row)

select TO_CHAR(-123,'$99,999.9') from dual;
  TO_CHAR   
------------
    -$123.0
(1 row)

select LENGTH(TO_CHAR(-123,'$99,999.9')) from dual;
 LENGTH 
--------
     10
(1 row)

-- numeric_to_char
select TO_CHAR(123.99,'$99,999.9') from dual;
  TO_CHAR   
------------
     $124.0
(1 row)

select LENGTH(TO_CHAR(123.99,'$99,999.9')) from dual;
 LENGTH 
--------
     10
(1 row)

select TO_CHAR(123.99,'$99,9,999.9') from dual;
   TO_CHAR    
--------------
       $124.0
(1 row)

select LENGTH(TO_CHAR(123.99,'$99,9,999.9')) from dual;
 LENGTH 
--------
     12
(1 row)

select TO_CHAR(123.99,'99,9,9$99.9') from dual;
   TO_CHAR    
--------------
       $124.0
(1 row)

select LENGTH(TO_CHAR(123.99,'99,9,9$99.9')) from dual;
 LENGTH 
--------
     12
(1 row)

select TO_CHAR(123.99,'99,9,999.9$') from dual;
   TO_CHAR    
--------------
       $124.0
(1 row)

select LENGTH(TO_CHAR(123.99,'99,9,999.9$')) from dual;
 LENGTH 
--------
     12
(1 row)

-- with sign
select TO_CHAR(-123.99,'$99,999.9') from dual;
  TO_CHAR   
------------
    -$124.0
(1 row)

select LENGTH(TO_CHAR(-123.99,'$99,999.9')) from dual;
 LENGTH 
--------
     10
(1 row)

select TO_CHAR(+123.99,'$99,999.9') from dual;
  TO_CHAR   
------------
     $124.0
(1 row)

select LENGTH(TO_CHAR(+123.99,'$99,999.9')) from dual;
 LENGTH 
--------
     10
(1 row)

---------------------------------------------------------------------------------------------------------------------------------------
--add TO_CHAR to convert the integer, float, numeric to hex digit string
select TO_CHAR(20, 'aa') from dual;
ERROR:  Invalid number format model
select TO_CHAR(22221., 'xxxxxxx') from dual;
 TO_CHAR  
----------
     56cd
(1 row)

select TO_CHAR(22221., 'XXXXXXX') from dual;
 TO_CHAR  
----------
     56CD
(1 row)

select TO_CHAR(22221.4, 'xxxxxxx') from dual;
 TO_CHAR  
----------
     56cd
(1 row)

select TO_CHAR(22221.5, 'xxxxxxx') from dual;
 TO_CHAR  
----------
     56ce
(1 row)

select TO_CHAR(-22221.4, 'xxxxxxx') from dual;
 TO_CHAR  
----------
 ########
(1 row)

select TO_CHAR(912222, 'xxxxx') from dual;
 TO_CHAR 
---------
  deb5e
(1 row)

select TO_CHAR(912222, 'XXXXX') from dual;
 TO_CHAR 
---------
  DEB5E
(1 row)

select TO_CHAR(912222, 'xxxx') from dual;
 TO_CHAR 
---------
 #####
(1 row)

select TO_CHAR(-912222, 'xxxxxxx') from dual;
 TO_CHAR  
----------
 ########
(1 row)

select TO_CHAR(2e4, 'XXXx') from dual;
 TO_CHAR 
---------
  4e20
(1 row)

select TO_CHAR(2e-4, 'XXXx') from dual;
 TO_CHAR 
---------
     0
(1 row)

select TO_CHAR(2e0, 'XXXx') from dual;
 TO_CHAR 
---------
     2
(1 row)

select TO_CHAR(-2e0, 'XXXx') from dual;
 TO_CHAR 
---------
 #####
(1 row)

select TO_CHAR(912222, 'XxxxxxxxxxxxxxxxxxxxxxxxxxXxxxxxxxxxxxxxXxxxxxxxxxxxxxxxxxxxxxX') from dual;
                             TO_CHAR                              
------------------------------------------------------------------
                                                            deb5e
(1 row)

select TO_CHAR(912222, 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx') from dual;
                             TO_CHAR                              
------------------------------------------------------------------
                                                            deb5e
(1 row)

select TO_CHAR(912222, 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx') from dual;
ERROR:  invalid number format model
drop table if exists tr_tbl_to_char;
create table tr_tbl_to_char(f1 integer, f2 float, f3 double precision, f4 numeric(10,2));
insert into tr_tbl_to_char values(255, 255.4, 65535.9999999, -32765.89);
insert into tr_tbl_to_char values(254, 253.4, 65534.9999999, 32765.89);
insert into tr_tbl_to_char values(-254, 253.4, 65534.9999999, 32765.89);
select TO_CHAR(f1, 'XXXX'), TO_CHAR(f2, 'xxxx'), TO_CHAR(f3, 'xxxX'), TO_CHAR(f4, 'XXXXX') from tr_tbl_to_char order by f1;
 TO_CHAR | TO_CHAR | TO_CHAR | TO_CHAR 
---------+---------+---------+---------
 #####   |    fd   |  ffff   |   7FFE
    FE   |    fd   |  ffff   |   7FFE
    FF   |    ff   | #####   | ######
(3 rows)

drop table tr_tbl_to_char;
------------------------------------------------------------------------------------------------------------------------------
--test TO_NUMBER
SELECT TO_NUMBER('-34,338,492', '99G999G999') from dual;
 TO_NUMBER 
-----------
 -34338492
(1 row)

SELECT TO_NUMBER('-34,338,492.654,878', '99G999G999D999G999') from dual;
ERROR:  Invalid number format model
SELECT TO_NUMBER('<564646.654564>', '999999.999999PR') from dual;
   TO_NUMBER    
----------------
 -564646.654564
(1 row)

SELECT TO_NUMBER('0.00001-', '9.999999S') from dual;
 TO_NUMBER 
-----------
   -.00001
(1 row)

SELECT TO_NUMBER('5.01-', 'FM9.999999S') from dual;
 TO_NUMBER 
-----------
     -5.01
(1 row)

SELECT TO_NUMBER('5.01-', 'FM9.999999MI') from dual;
 TO_NUMBER 
-----------
     -5.01
(1 row)

SELECT TO_NUMBER('5 4 4 4 4 8 . 7 8', '9 9 9 9 9 9 . 9 9') from dual;
ERROR:  Invalid number format model
SELECT TO_NUMBER('.01', 'FM9.99') from dual;
 TO_NUMBER 
-----------
       .01
(1 row)

SELECT TO_NUMBER('.0', '99999999.99999999') from dual;
 TO_NUMBER 
-----------
         0
(1 row)

SELECT TO_NUMBER('0', '99.99') from dual;
 TO_NUMBER 
-----------
         0
(1 row)

SELECT TO_NUMBER('.-01', 'S99.99') from dual;
ERROR:  invalid number
SELECT TO_NUMBER('.01-', '99.99S') from dual;
 TO_NUMBER 
-----------
      -.01
(1 row)

SELECT TO_NUMBER(' . 0 1-', ' 9 9 . 9 9 S') from dual;
ERROR:  Invalid number format model
SELECT TO_NUMBER('-34338492') from dual;
 TO_NUMBER 
-----------
 -34338492
(1 row)

SELECT TO_NUMBER('-34338492.654878') from dual;
    TO_NUMBER     
------------------
 -34338492.654878
(1 row)

SELECT TO_NUMBER('564646.654564') from dual;
   TO_NUMBER   
---------------
 564646.654564
(1 row)

SELECT TO_NUMBER('0.00001') from dual;
 TO_NUMBER 
-----------
    .00001
(1 row)

SELECT TO_NUMBER('5.01') from dual;
 TO_NUMBER 
-----------
      5.01
(1 row)

SELECT TO_NUMBER('.01') from dual;
 TO_NUMBER 
-----------
       .01
(1 row)

SELECT TO_NUMBER('.0') from dual;
 TO_NUMBER 
-----------
         0
(1 row)

SELECT TO_NUMBER('0') from dual;
 TO_NUMBER 
-----------
         0
(1 row)

SELECT TO_NUMBER('01') from dual;
 TO_NUMBER 
-----------
         1
(1 row)

select TO_NUMBER(123.09e34::float4) from dual;
               TO_NUMBER               
---------------------------------------
 1230900000000000000000000000000000000
(1 row)

select TO_NUMBER(1234.094e23::float8) from dual;
          TO_NUMBER          
-----------------------------
 123409400000000000000000000
(1 row)

SELECT TO_NUMBER('123'::text);
 TO_NUMBER 
-----------
       123
(1 row)

SELECT TO_NUMBER('123.456'::text);
 TO_NUMBER 
-----------
   123.456
(1 row)

SELECT TO_NUMBER(123);
 TO_NUMBER 
-----------
       123
(1 row)

SELECT TO_NUMBER(123::smallint);
 TO_NUMBER 
-----------
       123
(1 row)

SELECT TO_NUMBER(123::int);
 TO_NUMBER 
-----------
       123
(1 row)

SELECT TO_NUMBER(123::bigint);
 TO_NUMBER 
-----------
       123
(1 row)

SELECT TO_NUMBER(123::numeric);
 TO_NUMBER 
-----------
       123
(1 row)

SELECT TO_NUMBER(123.456);
 TO_NUMBER 
-----------
   123.456
(1 row)

------------------------------------------------------------------------------------------------------------------------------
-- Tests for to_multi_byte
SELECT to_multi_byte('123$test');
  TO_MULTI_BYTE   
------------------
 １２３＄ｔｅｓｔ
(1 row)

-- Check internal representation difference
SELECT octet_length('abc');
 OCTET_LENGTH 
--------------
            3
(1 row)

SELECT octet_length(to_multi_byte('abc'));
 OCTET_LENGTH 
--------------
            9
(1 row)

-- Tests for to_single_byte
SELECT to_single_byte('123$test');
 TO_SINGLE_BYTE 
----------------
 123$test
(1 row)

SELECT to_single_byte('１２３＄ｔｅｓｔ');
 TO_SINGLE_BYTE 
----------------
 123$test
(1 row)

-- Check internal representation difference
SELECT octet_length('ａｂｃ');
 OCTET_LENGTH 
--------------
            9
(1 row)

SELECT octet_length(to_single_byte('ａｂｃ'));
 OCTET_LENGTH 
--------------
            3
(1 row)

RESET intervalstyle;
