--
-- gbk
--
\c db_gbk;
SET client_encoding = gbk;
-- regular expression query
SELECT * FROM tbl_gbk WHERE f1 ~ '^王' ORDER BY f1;
   F1   
--------
 王家坝
 王一位
(2 rows)

DROP TABLE tbl_gbk;
CREATE TABLE tbl_gbk(f1 varchar(3));
INSERT INTO tbl_gbk (f1) VALUES ('邓东宝');
INSERT INTO tbl_gbk (f1) VALUES ('李尔王');
-- F is not support by euc_cn, but support on gbk
INSERT INTO tbl_gbk (f1) VALUES ('朱F非');
INSERT INTO tbl_gbk (f1) VALUES ('王家坝');
INSERT INTO tbl_gbk (f1) VALUES ('王一位');
INSERT INTO tbl_gbk (f1) VALUES ('怡宝');
-- error
INSERT INTO tbl_gbk (f1) VALUES ('王家坝2');
ERROR:  value too long for type character(3), actual(4)
-- order by
SELECT * FROM tbl_gbk ORDER BY f1;
   F1   
--------
 邓东宝
 李尔王
 王家坝
 王一位
 怡宝
 朱F非
(6 rows)

-- regular expression query
SELECT * FROM tbl_gbk WHERE f1 ~ '^王' ORDER BY f1;
   F1   
--------
 王家坝
 王一位
(2 rows)

-- query encoding length
SELECT OCTET_LENGTH(f1) FROM tbl_gbk ORDER BY f1;
 OCTET_LENGTH 
--------------
            6
            6
            6
            6
            4
            6
(6 rows)

--
-- gb18030
--
\c "DB_GB18030";
SET client_encoding = gb18030;
-- regular expression query
SELECT * FROM tbl_gb18030 WHERE f1 ~ '^王' ORDER BY f1;
   F1   
--------
 王家坝
 王一位
(2 rows)

SELECT * FROM tbl_gb18030 WHERE f1 ~ '^?0?0' ORDER BY f1;
   F1   
--------
 ?0?0?3?3?5?3
(1 row)

DROP TABLE tbl_gb18030;
CREATE TABLE tbl_gb18030(f1 varchar(3));
INSERT INTO tbl_gb18030 (f1) VALUES ('邓东宝');
INSERT INTO tbl_gb18030 (f1) VALUES ('李尔王');
-- F is not support by euc_cn, but support on gb18030
INSERT INTO tbl_gb18030 (f1) VALUES ('朱F非');
INSERT INTO tbl_gb18030 (f1) VALUES ('王家坝');
INSERT INTO tbl_gb18030 (f1) VALUES ('王一位');
INSERT INTO tbl_gb18030 (f1) VALUES ('怡宝');
-- which not support by gbk, but support on gb18030
INSERT INTO tbl_gb18030 (f1) VALUES ('?0?0?3?3?5?3');
-- out of bound error
INSERT INTO tbl_gb18030 (f1) VALUES ('王家坝2');
ERROR:  value too long for type character(3), actual(4)
INSERT INTO tbl_gb18030 (f1) VALUES ('?0?0?3?3?5?32');
ERROR:  value too long for type character(3), actual(4)
-- order by
SELECT * FROM tbl_gb18030 ORDER BY f1;
   F1   
--------
 ?0?0?3?3?5?3
 邓东宝
 李尔王
 王家坝
 王一位
 怡宝
 朱F非
(7 rows)

-- regular expression query
SELECT * FROM tbl_gb18030 WHERE f1 ~ '^王' ORDER BY f1;
   F1   
--------
 王家坝
 王一位
(2 rows)

SELECT * FROM tbl_gb18030 WHERE f1 ~ '^?0?0' ORDER BY f1;
   F1   
--------
 ?0?0?3?3?5?3
(1 row)

-- query encoding length
SELECT OCTET_LENGTH(f1) FROM tbl_gb18030 ORDER BY f1;
 OCTET_LENGTH 
--------------
           12
            6
            6
            6
            6
            4
            6
(7 rows)

-- test redistribution
CREATE TABLE tbl_gb18030_re(i int, name_varchar varchar(32), name_name name);
INSERT INTO tbl_gb18030_re(i, name_varchar, name_name) SELECT length(f1), f1, f1::name from tbl_gb18030;
SELECT * FROM tbl_gb18030_re ORDER BY name_varchar;
 I | NAME_VARCHAR | NAME_NAME 
---+--------------+-----------
 3 | ?0?0?3?3?5?3       | ?0?0?3?3?5?3
 3 | 邓东宝       | 邓东宝
 3 | 李尔王       | 李尔王
 3 | 王家坝       | 王家坝
 3 | 王一位       | 王一位
 2 | 怡宝         | 怡宝
 3 | 朱F非       | 朱F非
(7 rows)

SELECT * FROM tbl_gb18030_re ORDER BY name_name;
 I | NAME_VARCHAR | NAME_NAME 
---+--------------+-----------
 3 | ?0?0?3?3?5?3       | ?0?0?3?3?5?3
 3 | 邓东宝       | 邓东宝
 3 | 李尔王       | 李尔王
 3 | 王家坝       | 王家坝
 3 | 王一位       | 王一位
 3 | 朱F非       | 朱F非
 2 | 怡宝         | 怡宝
(7 rows)

SELECT * FROM tbl_gb18030_re WHERE name_varchar ~ '^王' ORDER BY name_varchar;
 I | NAME_VARCHAR | NAME_NAME 
---+--------------+-----------
 3 | 王家坝       | 王家坝
 3 | 王一位       | 王一位
(2 rows)

SELECT * FROM tbl_gb18030_re WHERE name_varchar ~ '^?0?0' ORDER BY name_varchar;
 I | NAME_VARCHAR | NAME_NAME 
---+--------------+-----------
 3 | ?0?0?3?3?5?3       | ?0?0?3?3?5?3
(1 row)

SELECT * FROM tbl_gb18030_re WHERE name_name ~ '^王' ORDER BY name_name;
 I | NAME_VARCHAR | NAME_NAME 
---+--------------+-----------
 3 | 王家坝       | 王家坝
 3 | 王一位       | 王一位
(2 rows)

SELECT * FROM tbl_gb18030_re WHERE name_name ~ '^?0?0' ORDER BY name_name;
 I | NAME_VARCHAR | NAME_NAME 
---+--------------+-----------
 3 | ?0?0?3?3?5?3       | ?0?0?3?3?5?3
(1 row)

DROP TABLE tbl_gb18030_re;
